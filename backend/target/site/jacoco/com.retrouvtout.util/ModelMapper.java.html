<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ModelMapper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RetrouvTout Backend</a> &gt; <a href="index.source.html" class="el_package">com.retrouvtout.util</a> &gt; <span class="el_source">ModelMapper.java</span></div><h1>ModelMapper.java</h1><pre class="source lang-java linenums">package com.retrouvtout.util;

import com.retrouvtout.dto.response.*;
import com.retrouvtout.entity.*;
import com.retrouvtout.repository.MessageRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.PageRequest;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;
import java.util.List;

/**
 * Utilitaire pour mapper les entités vers les DTOs de réponse
 */
@Component
<span class="nc" id="L17">public class ModelMapper {</span>

    @Autowired
    private MessageRepository messageRepository;

    /**
     * Mapper User vers UserResponse
     */
    public UserResponse mapUserToUserResponse(User user) {
<span class="nc bnc" id="L26" title="All 2 branches missed.">        if (user == null) {</span>
<span class="nc" id="L27">            return null;</span>
        }

<span class="nc" id="L30">        UserResponse response = new UserResponse();</span>
<span class="nc" id="L31">        response.setId(user.getId());</span>
<span class="nc" id="L32">        response.setName(user.getName());</span>
<span class="nc" id="L33">        response.setEmail(user.getEmail());</span>
<span class="nc" id="L34">        response.setPhone(user.getPhone());</span>
<span class="nc bnc" id="L35" title="All 2 branches missed.">        response.setRole(user.getRole() != null ? user.getRole().getValue() : null);</span>
<span class="nc" id="L36">        response.setEmailVerified(user.getEmailVerified());</span>
<span class="nc" id="L37">        response.setActive(user.getActive());</span>
<span class="nc" id="L38">        response.setCreatedAt(user.getCreatedAt());</span>
<span class="nc" id="L39">        response.setLastLoginAt(user.getLastLoginAt());</span>

<span class="nc" id="L41">        return response;</span>
    }

    /**
     * Mapper User vers UserResponse (version publique sans informations sensibles)
     */
    public UserResponse mapUserToPublicUserResponse(User user) {
<span class="nc bnc" id="L48" title="All 2 branches missed.">        if (user == null) {</span>
<span class="nc" id="L49">            return null;</span>
        }

<span class="nc" id="L52">        UserResponse response = new UserResponse();</span>
<span class="nc" id="L53">        response.setId(user.getId());</span>
<span class="nc" id="L54">        response.setName(user.getName());</span>
        // Ne pas inclure l'email et le téléphone dans la version publique
<span class="nc bnc" id="L56" title="All 2 branches missed.">        response.setRole(user.getRole() != null ? user.getRole().getValue() : null);</span>
<span class="nc" id="L57">        response.setCreatedAt(user.getCreatedAt());</span>

<span class="nc" id="L59">        return response;</span>
    }

    /**
     * Mapper Listing vers ListingResponse
     */
    public ListingResponse mapListingToListingResponse(Listing listing) {
<span class="nc bnc" id="L66" title="All 2 branches missed.">        if (listing == null) {</span>
<span class="nc" id="L67">            return null;</span>
        }

<span class="nc" id="L70">        ListingResponse response = new ListingResponse();</span>
<span class="nc" id="L71">        response.setId(listing.getId());</span>
<span class="nc" id="L72">        response.setTitle(listing.getTitle());</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">        response.setCategory(listing.getCategory() != null ? listing.getCategory().getValue() : null);</span>
<span class="nc" id="L74">        response.setLocationText(listing.getLocationText());</span>
<span class="nc" id="L75">        response.setLatitude(listing.getLatitude());</span>
<span class="nc" id="L76">        response.setLongitude(listing.getLongitude());</span>
<span class="nc" id="L77">        response.setFoundAt(listing.getFoundAt());</span>
<span class="nc" id="L78">        response.setDescription(listing.getDescription());</span>
<span class="nc" id="L79">        response.setImageUrl(listing.getImageUrl());</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">        response.setStatus(listing.getStatus() != null ? listing.getStatus().getValue() : null);</span>
<span class="nc" id="L81">        response.setViewsCount(listing.getViewsCount());</span>
<span class="nc" id="L82">        response.setIsModerated(listing.getIsModerated());</span>
<span class="nc" id="L83">        response.setCreatedAt(listing.getCreatedAt());</span>
<span class="nc" id="L84">        response.setUpdatedAt(listing.getUpdatedAt());</span>

        // Mapper l'utilisateur retrouveur (version publique)
<span class="nc bnc" id="L87" title="All 2 branches missed.">        if (listing.getFinderUser() != null) {</span>
<span class="nc" id="L88">            response.setFinderUser(mapUserToPublicUserResponse(listing.getFinderUser()));</span>
        }

<span class="nc" id="L91">        return response;</span>
    }

    /**
     * Mapper Alert vers AlertResponse
     */
    public AlertResponse mapAlertToAlertResponse(Alert alert) {
<span class="nc bnc" id="L98" title="All 2 branches missed.">        if (alert == null) {</span>
<span class="nc" id="L99">            return null;</span>
        }

<span class="nc" id="L102">        AlertResponse response = new AlertResponse();</span>
<span class="nc" id="L103">        response.setId(alert.getId());</span>
<span class="nc" id="L104">        response.setTitle(alert.getTitle());</span>
<span class="nc" id="L105">        response.setQueryText(alert.getQueryText());</span>
<span class="nc" id="L106">        response.setCategory(alert.getCategory());</span>
<span class="nc" id="L107">        response.setLocationText(alert.getLocationText());</span>
<span class="nc" id="L108">        response.setLatitude(alert.getLatitude());</span>
<span class="nc" id="L109">        response.setLongitude(alert.getLongitude());</span>
<span class="nc" id="L110">        response.setRadiusKm(alert.getRadiusKm());</span>
<span class="nc" id="L111">        response.setDateFrom(alert.getDateFrom());</span>
<span class="nc" id="L112">        response.setDateTo(alert.getDateTo());</span>
<span class="nc" id="L113">        response.setChannels(alert.getChannels());</span>
<span class="nc" id="L114">        response.setActive(alert.getActive());</span>
<span class="nc" id="L115">        response.setLastTriggeredAt(alert.getLastTriggeredAt());</span>
<span class="nc" id="L116">        response.setCreatedAt(alert.getCreatedAt());</span>
<span class="nc" id="L117">        response.setUpdatedAt(alert.getUpdatedAt());</span>

<span class="nc" id="L119">        return response;</span>
    }

    /**
     * Mapper Message vers MessageResponse
     */
    public MessageResponse mapMessageToMessageResponse(Message message) {
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if (message == null) {</span>
<span class="nc" id="L127">            return null;</span>
        }

<span class="nc" id="L130">        MessageResponse response = new MessageResponse();</span>
<span class="nc" id="L131">        response.setId(message.getId());</span>
<span class="nc" id="L132">        response.setThreadId(message.getThread().getId());</span>
<span class="nc" id="L133">        response.setSenderUser(mapUserToPublicUserResponse(message.getSenderUser()));</span>
<span class="nc" id="L134">        response.setBody(message.getBody());</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">        response.setMessageType(message.getMessageType() != null ? message.getMessageType().getValue() : null);</span>
<span class="nc" id="L136">        response.setIsRead(message.getIsRead());</span>
<span class="nc" id="L137">        response.setReadAt(message.getReadAt());</span>
<span class="nc" id="L138">        response.setCreatedAt(message.getCreatedAt());</span>

<span class="nc" id="L140">        return response;</span>
    }

    /**
     * Mapper Thread vers ThreadResponse
     */
    public ThreadResponse mapThreadToThreadResponse(com.retrouvtout.entity.Thread thread) {
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (thread == null) {</span>
<span class="nc" id="L148">            return null;</span>
        }

<span class="nc" id="L151">        ThreadResponse response = new ThreadResponse();</span>
<span class="nc" id="L152">        response.setId(thread.getId());</span>
<span class="nc" id="L153">        response.setListing(mapListingToListingResponse(thread.getListing()));</span>
<span class="nc" id="L154">        response.setOwnerUser(mapUserToPublicUserResponse(thread.getOwnerUser()));</span>
<span class="nc" id="L155">        response.setFinderUser(mapUserToPublicUserResponse(thread.getFinderUser()));</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">        response.setStatus(thread.getStatus() != null ? thread.getStatus().getValue() : null);</span>
<span class="nc" id="L157">        response.setApprovedByOwner(thread.getApprovedByOwner());</span>
<span class="nc" id="L158">        response.setApprovedByFinder(thread.getApprovedByFinder());</span>
<span class="nc" id="L159">        response.setLastMessageAt(thread.getLastMessageAt());</span>
<span class="nc" id="L160">        response.setCreatedAt(thread.getCreatedAt());</span>
<span class="nc" id="L161">        response.setUpdatedAt(thread.getUpdatedAt());</span>

        // Ajouter le dernier message
        try {
<span class="nc" id="L165">            List&lt;Message&gt; lastMessages = messageRepository.findLastMessageInThread(</span>
<span class="nc" id="L166">                thread, PageRequest.of(0, 1));</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">            if (!lastMessages.isEmpty()) {</span>
<span class="nc" id="L168">                response.setLastMessage(mapMessageToMessageResponse(lastMessages.get(0)));</span>
            }
<span class="nc" id="L170">        } catch (Exception e) {</span>
            // Ignorer l'erreur si on ne peut pas récupérer le dernier message
<span class="nc" id="L172">        }</span>

<span class="nc" id="L174">        return response;</span>
    }

    /**
     * Mapper Confirmation vers ConfirmationResponse
     */
    public ConfirmationResponse mapConfirmationToConfirmationResponse(Confirmation confirmation) {
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (confirmation == null) {</span>
<span class="nc" id="L182">            return null;</span>
        }

<span class="nc" id="L185">        ConfirmationResponse response = new ConfirmationResponse();</span>
<span class="nc" id="L186">        response.setId(confirmation.getId());</span>
<span class="nc" id="L187">        response.setThreadId(confirmation.getThread().getId());</span>
<span class="nc" id="L188">        response.setCode(confirmation.getCode());</span>
<span class="nc" id="L189">        response.setExpiresAt(confirmation.getExpiresAt());</span>
<span class="nc" id="L190">        response.setUsedAt(confirmation.getUsedAt());</span>
<span class="nc" id="L191">        response.setCreatedAt(confirmation.getCreatedAt());</span>
        
        // Calculer les statuts
<span class="nc" id="L194">        response.setIsExpired(confirmation.isExpired());</span>
<span class="nc" id="L195">        response.setIsUsed(confirmation.isUsed());</span>

<span class="nc bnc" id="L197" title="All 2 branches missed.">        if (confirmation.getUsedByUser() != null) {</span>
<span class="nc" id="L198">            response.setUsedByUser(mapUserToPublicUserResponse(confirmation.getUsedByUser()));</span>
        }

<span class="nc" id="L201">        return response;</span>
    }

    /**
     * Mapper ModerationFlag vers ModerationFlagResponse
     */
    public ModerationFlagResponse mapModerationFlagToModerationFlagResponse(ModerationFlag flag) {
<span class="nc bnc" id="L208" title="All 2 branches missed.">        if (flag == null) {</span>
<span class="nc" id="L209">            return null;</span>
        }

<span class="nc" id="L212">        ModerationFlagResponse response = new ModerationFlagResponse();</span>
<span class="nc" id="L213">        response.setId(flag.getId());</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">        response.setEntityType(flag.getEntityType() != null ? flag.getEntityType().getValue() : null);</span>
<span class="nc" id="L215">        response.setEntityId(flag.getEntityId());</span>
<span class="nc" id="L216">        response.setReason(flag.getReason());</span>
<span class="nc" id="L217">        response.setDescription(flag.getDescription());</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">        response.setStatus(flag.getStatus() != null ? flag.getStatus().getValue() : null);</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">        response.setPriority(flag.getPriority() != null ? flag.getPriority().getValue() : null);</span>
<span class="nc" id="L220">        response.setCreatedAt(flag.getCreatedAt());</span>
<span class="nc" id="L221">        response.setReviewedAt(flag.getReviewedAt());</span>

<span class="nc bnc" id="L223" title="All 2 branches missed.">        if (flag.getCreatedByUser() != null) {</span>
<span class="nc" id="L224">            response.setCreatedByUser(mapUserToPublicUserResponse(flag.getCreatedByUser()));</span>
        }

<span class="nc bnc" id="L227" title="All 2 branches missed.">        if (flag.getReviewedByUser() != null) {</span>
<span class="nc" id="L228">            response.setReviewedByUser(mapUserToPublicUserResponse(flag.getReviewedByUser()));</span>
        }

<span class="nc" id="L231">        return response;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>