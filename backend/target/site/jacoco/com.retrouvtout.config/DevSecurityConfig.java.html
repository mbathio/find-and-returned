<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DevSecurityConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">RetrouvTout Backend</a> &gt; <a href="index.source.html" class="el_package">com.retrouvtout.config</a> &gt; <span class="el_source">DevSecurityConfig.java</span></div><h1>DevSecurityConfig.java</h1><pre class="source lang-java linenums">package com.retrouvtout.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import org.springframework.core.annotation.Order;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import java.util.List;

/**
 * âœ… CONFIGURATION DE SÃ‰CURITÃ‰ SIMPLIFIÃ‰E POUR LE DÃ‰VELOPPEMENT
 * Configuration ultra-permissive pour Ã©viter les blocages en dev
 */
@Configuration
@EnableWebSecurity
@Profile(&quot;dev&quot;)
<span class="nc" id="L26">public class DevSecurityConfig {</span>

    /**
     * âœ… Bean PasswordEncoder OBLIGATOIRE
     */
    @Bean
    public PasswordEncoder passwordEncoder() {
<span class="nc" id="L33">        return new BCryptPasswordEncoder(12);</span>
    }

    /**
     * âœ… Configuration de sÃ©curitÃ© ULTRA-PERMISSIVE pour le dÃ©veloppement
     */
    @Bean
    @Order(1)
    public SecurityFilterChain devFilterChain(HttpSecurity http) throws Exception {
<span class="nc" id="L42">        System.out.println(&quot;ðŸ”§ Configuration de sÃ©curitÃ© DEV - Mode permissif&quot;);</span>
        
<span class="nc" id="L44">        return http</span>
            // âœ… DÃ©sactiver CSRF complÃ¨tement
<span class="nc" id="L46">            .csrf(csrf -&gt; csrf.disable())</span>
            
            // âœ… Configuration CORS ultra-permissive
<span class="nc" id="L49">            .cors(cors -&gt; cors.configurationSource(corsConfigurationSource()))</span>
            
            // âœ… Autoriser ABSOLUMENT TOUT en dÃ©veloppement
<span class="nc" id="L52">            .authorizeHttpRequests(authz -&gt; authz</span>
                // Health checks
<span class="nc" id="L54">                .requestMatchers(&quot;/&quot;, &quot;/health&quot;, &quot;/actuator/**&quot;).permitAll()</span>
                
                // API d'authentification - TOUT AUTORISER
<span class="nc" id="L57">                .requestMatchers(&quot;/api/auth/**&quot;).permitAll()</span>
                
                // Tests de DB
<span class="nc" id="L60">                .requestMatchers(&quot;/api/db-test/**&quot;).permitAll()</span>
                
                // API de test
<span class="nc" id="L63">                .requestMatchers(&quot;/api/test/**&quot;).permitAll()</span>
<span class="nc" id="L64">                .requestMatchers(&quot;/api/ping&quot;).permitAll()</span>
<span class="nc" id="L65">                .requestMatchers(&quot;/api/cors-test&quot;).permitAll()</span>
                
                // Tous les endpoints API (permissif en dev)
<span class="nc" id="L68">                .requestMatchers(&quot;/api/**&quot;).permitAll()</span>
                
                // Swagger/OpenAPI
<span class="nc" id="L71">                .requestMatchers(&quot;/swagger-ui/**&quot;, &quot;/v3/api-docs/**&quot;, &quot;/api-docs/**&quot;).permitAll()</span>
                
                // Fichiers statiques
<span class="nc" id="L74">                .requestMatchers(&quot;/files/**&quot;, &quot;/uploads/**&quot;, &quot;/static/**&quot;).permitAll()</span>
                
                // Chrome DevTools et autres
<span class="nc" id="L77">                .requestMatchers(&quot;/.well-known/**&quot;).permitAll()</span>
<span class="nc" id="L78">                .requestMatchers(&quot;/favicon.ico&quot;).permitAll()</span>
                
                // AUTORISER TOUT LE RESTE
<span class="nc" id="L81">                .anyRequest().permitAll()</span>
            )
            
            // âœ… Session stateless pour les API REST
<span class="nc" id="L85">            .sessionManagement(session -&gt; session</span>
<span class="nc" id="L86">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS))</span>
            
            // âœ… DÃ©sactiver toutes les protections en dev
<span class="nc" id="L89">            .headers(headers -&gt; headers</span>
<span class="nc" id="L90">                .frameOptions().disable()</span>
<span class="nc" id="L91">                .contentTypeOptions().disable()</span>
<span class="nc" id="L92">                .httpStrictTransportSecurity().disable())</span>
            
            // âœ… Pas d'authentification de base
<span class="nc" id="L95">            .httpBasic().disable()</span>
<span class="nc" id="L96">            .formLogin().disable()</span>
<span class="nc" id="L97">            .logout().disable()</span>
            
<span class="nc" id="L99">            .build();</span>
    }

    /**
     * âœ… Configuration CORS ULTRA-PERMISSIVE pour le dÃ©veloppement
     */
    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
<span class="nc" id="L107">        System.out.println(&quot;ðŸ”§ Configuration CORS - Mode ultra-permissif&quot;);</span>
        
<span class="nc" id="L109">        CorsConfiguration configuration = new CorsConfiguration();</span>
        
        // âœ… Autoriser TOUTES les origines
<span class="nc" id="L112">        configuration.setAllowedOriginPatterns(List.of(&quot;*&quot;));</span>
<span class="nc" id="L113">        configuration.setAllowedOrigins(List.of(</span>
            &quot;http://localhost:8080&quot;,
            &quot;http://localhost:3000&quot;, 
            &quot;http://localhost:5173&quot;,
            &quot;http://127.0.0.1:8080&quot;,
            &quot;http://127.0.0.1:3000&quot;,
            &quot;http://127.0.0.1:5173&quot;
        ));
        
        // âœ… Autoriser TOUTES les mÃ©thodes HTTP
<span class="nc" id="L123">        configuration.setAllowedMethods(List.of(&quot;*&quot;));</span>
        
        // âœ… Autoriser TOUS les headers
<span class="nc" id="L126">        configuration.setAllowedHeaders(List.of(&quot;*&quot;));</span>
        
        // âœ… Headers exposÃ©s pour les API
<span class="nc" id="L129">        configuration.setExposedHeaders(List.of(</span>
            &quot;Authorization&quot;, 
            &quot;Cache-Control&quot;, 
            &quot;Content-Type&quot;,
            &quot;X-Total-Count&quot;, 
            &quot;X-Page-Number&quot;, 
            &quot;X-Page-Size&quot;,
            &quot;Access-Control-Allow-Origin&quot;,
            &quot;Access-Control-Allow-Methods&quot;,
            &quot;Access-Control-Allow-Headers&quot;
        ));
        
        // âœ… Autoriser les credentials
<span class="nc" id="L142">        configuration.setAllowCredentials(true);</span>
        
        // âœ… Cache CORS pendant 1 heure
<span class="nc" id="L145">        configuration.setMaxAge(3600L);</span>

        // âœ… Appliquer Ã  TOUTES les routes
<span class="nc" id="L148">        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();</span>
<span class="nc" id="L149">        source.registerCorsConfiguration(&quot;/**&quot;, configuration);</span>
        
<span class="nc" id="L151">        return source;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>